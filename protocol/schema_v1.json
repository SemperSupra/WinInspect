{{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "wininspect:protocol:v1",
  "title": "wininspect protocol v1",
  "type": "object",
  "oneOf": [
    {{"$ref": "#/$defs/Request"}},
    {{"$ref": "#/$defs/Response"}},
    {{"$ref": "#/$defs/Event"}}
  ],
  "$defs": {{
    "Id": {{"type":"string","minLength":1,"maxLength":64}},
    "Hwnd": {{"type":"string","pattern":"^0x[0-9A-Fa-f]{{1,16}}$"}},
    "SnapshotId": {{"type":"string","pattern":"^s-[A-Za-z0-9._-]{{1,64}}$"}},
    "Request": {{
      "type":"object",
      "required":["id","method","params"],
      "properties": {{
        "id": {{"$ref":"#/$defs/Id"}},
        "method": {{
          "type":"string",
          "enum":[
            "snapshot.capture",
            "window.listTop",
            "window.listChildren",
            "window.getInfo",
            "window.pickAtPoint",
            "window.ensureVisible",
            "window.ensureForeground",
            "events.subscribe",
            "events.unsubscribe",
            "events.poll"
          ]
        }},
        "params": {{"type":"object"}}
      }},
      "additionalProperties": false
    }},
    "Response": {{
      "type":"object",
      "required":["id","ok"],
      "properties": {{
        "id": {{"$ref":"#/$defs/Id"}},
        "ok": {{"type":"boolean"}},
        "result": {{"type":["object","array","string","number","boolean","null"]}},
        "error": {{
          "type":"object",
          "required":["code","message"],
          "properties": {{
            "code": {{"type":"string"}},
            "message": {{"type":"string"}}
          }},
          "additionalProperties": false
        }}
      }},
      "additionalProperties": false,
      "allOf": [
        {{
          "if": {{"properties": {{"ok": {{"const": true}}}}}},
          "then": {{"required":["result"],"not":{{"required":["error"]}}}}
        }},
        {{
          "if": {{"properties": {{"ok": {{"const": false}}}}}},
          "then": {{"required":["error"],"not":{{"required":["result"]}}}}
        }}
      ]
    }},
    "Event": {{
      "type":"object",
      "required":["type","subscription_id","payload"],
      "properties": {{
        "type": {{"type":"string","enum":["event"]}},
        "subscription_id": {{"type":"string","pattern":"^sub-[A-Za-z0-9._-]{{1,64}}$"}},
        "payload": {{"type":"object"}}
      }},
      "additionalProperties": false
    }}
  }}
}}
